{"version":3,"sources":["../dist-esnext/Game.js"],"names":["getCleanGameToSaveOnServer","Game","args","ended","needToValidateMovements","board","boardArgs","white","boardOptions","black","setMovements","movements","setPlayers","players","fillAllPiecesOnBoard","pieces","length","startPosition","cleanBoardWhereCanIGo","blackPiece","isBlackPiece","whiteTurn","isWhiteTurn","setWhereCanIGo","setColorWinners","win","blackWin","nextPosition","positionsWhereCanIGo","getPositionsWhereCanIGo","positions","nextPositionFound","findIndex","position","x","y","backMove","isSamePositionAs","Error","canMove","move","push","verifyWinner","lastMove","pop","getPlayerTurn","isComputer","game","cleanGame","map"],"mappings":"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","file":"Game.js","sourcesContent":["import copy from 'ptz-copy';\nimport { BoardPosition } from './BoardPosition';\nimport { GameBoard } from './GameBoard';\nimport { GameColor } from './GameColor';\nexport class Game {\n    /**\n     * Create new Game\n     */\n    constructor(args = {}) {\n        this.ended = false;\n        if (args.needToValidateMovements !== true && args.needToValidateMovements !== false)\n            args.needToValidateMovements = true;\n        this.board = new GameBoard(args.boardArgs);\n        this.white = new GameColor(this.board.boardOptions, false);\n        this.black = new GameColor(this.board.boardOptions, true);\n        this.setMovements(args.movements, args.needToValidateMovements);\n        this.setPlayers(args.players);\n    }\n    setPlayers(players) {\n        // Validate Players\n        this.players = players;\n    }\n    setMovements(movements = [], needToValidateMovements = true) {\n        // Validate Movements\n        // if(needToValidateMovements)\n        this.movements = movements;\n        this.board.fillAllPiecesOnBoard(this.white.pieces, this.black.pieces);\n    }\n    isWhiteTurn() {\n        return this.movements.length % 2 === 0;\n    }\n    setWhereCanIGo(startPosition) {\n        this.board.cleanBoardWhereCanIGo();\n        const blackPiece = startPosition.isBlackPiece();\n        const whiteTurn = this.isWhiteTurn();\n        if (this.ended || blackPiece === null\n            || (!blackPiece && !whiteTurn)\n            || (blackPiece && whiteTurn))\n            return;\n        this.board.setWhereCanIGo(startPosition, blackPiece);\n    }\n    verifyWinner() {\n        this.white.setColorWinners();\n        this.black.setColorWinners();\n        if (this.white.win())\n            this.blackWin = false;\n        else if (this.black.win())\n            this.blackWin = true;\n    }\n    canMove(startPosition, nextPosition) {\n        const positionsWhereCanIGo = this.board.getPositionsWhereCanIGo(startPosition, !this.isWhiteTurn()).positions;\n        var nextPositionFound = false;\n        nextPositionFound = positionsWhereCanIGo.findIndex(position => position.x === nextPosition.x\n            && position.y === nextPosition.y) >= 0;\n        this.board.cleanBoardWhereCanIGo();\n        return nextPositionFound;\n    }\n    move(startPosition, nextPosition, backMove = false) {\n        if (startPosition.isSamePositionAs(nextPosition))\n            throw new Error('ERROR_CANT_MOVE_TO_SAME_POSITION');\n        if (!backMove)\n            if (!this.canMove(startPosition, nextPosition))\n                throw new Error('ERROR_CANT_MOVE_TO_POSITION');\n        this.board.move(startPosition, nextPosition, backMove, this.isWhiteTurn());\n        this.black.move(startPosition, nextPosition);\n        this.white.move(startPosition, nextPosition);\n        if (!backMove) {\n            this.movements.push({ startPosition, nextPosition });\n            this.verifyWinner();\n        }\n    }\n    backMove() {\n        this.board.cleanBoardWhereCanIGo();\n        let lastMove = this.movements.pop();\n        if (lastMove)\n            this.move(lastMove.nextPosition, lastMove.startPosition, true);\n        if (this.getPlayerTurn().isComputer()) {\n            lastMove = this.movements.pop();\n            if (lastMove) {\n                this.board.cleanBoardWhereCanIGo();\n                this.move(lastMove.nextPosition, lastMove.startPosition, true);\n            }\n        }\n    }\n    getColorTurn() {\n        return this.isWhiteTurn ? this.white : this.black;\n    }\n    getPlayerTurn() {\n        return this.isWhiteTurn ? this.players.white : this.players.black;\n    }\n    getNewCopy() {\n        return new Game(this);\n    }\n    getCopy() {\n        return copy(this);\n    }\n}\nexport function getCleanGameToSaveOnServer(game) {\n    const cleanGame = {\n        ended: game.ended,\n        movements: [],\n        blackWin: game.blackWin\n    };\n    cleanGame.movements = game.movements.map(move => {\n        const startPosition = new BoardPosition({ x: move.startPosition.x, y: move.startPosition.y });\n        const nextPosition = new BoardPosition({ x: move.nextPosition.x, y: move.nextPosition.y });\n        return { startPosition, nextPosition };\n    });\n    return cleanGame;\n}\n//# sourceMappingURL=Game.js.map"]}