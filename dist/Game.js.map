{"version":3,"sources":["../dist-esnext/Game.js"],"names":["getCleanGameToSaveOnServer","getWinner","Game","args","ended","needToValidateMovements","board","boardArgs","white","boardOptions","black","setMovements","movements","setPlayers","players","fillAllPiecesOnBoard","pieces","length","startPosition","cleanBoardWhereCanIGo","blackPiece","isBlackPiece","whiteTurn","isWhiteTurn","setWhereCanIGo","nextPosition","positionsWhereCanIGo","getPositionsWhereCanIGo","positions","nextPositionFound","findIndex","position","x","y","backMove","game","isSamePositionAs","Error","canMove","move","push","lastMove","pop","getPlayerTurn","isComputer","cleanGame","blackWin","map"],"mappings":"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","file":"Game.js","sourcesContent":["import copy from 'ptz-copy';\nimport { BoardPosition } from './BoardPosition';\nimport { GameBoard } from './GameBoard';\nimport { colorWin, GameColor, setColorWinners } from './GameColor';\nexport class Game {\n    /**\n     * Create new Game\n     */\n    constructor(args = {}) {\n        this.ended = false;\n        if (args.needToValidateMovements !== true && args.needToValidateMovements !== false)\n            args.needToValidateMovements = true;\n        this.board = new GameBoard(args.boardArgs);\n        this.white = new GameColor(this.board.boardOptions, false);\n        this.black = new GameColor(this.board.boardOptions, true);\n        this.setMovements(args.movements, args.needToValidateMovements);\n        this.setPlayers(args.players);\n    }\n    setPlayers(players) {\n        // Validate Players\n        this.players = players;\n    }\n    setMovements(movements = [], needToValidateMovements = true) {\n        // Validate Movements\n        // if(needToValidateMovements)\n        this.movements = movements;\n        this.board.fillAllPiecesOnBoard(this.white.pieces, this.black.pieces);\n    }\n    isWhiteTurn() {\n        return this.movements.length % 2 === 0;\n    }\n    setWhereCanIGo(startPosition) {\n        this.board.cleanBoardWhereCanIGo();\n        const blackPiece = startPosition.isBlackPiece();\n        const whiteTurn = this.isWhiteTurn();\n        if (this.ended || blackPiece === null\n            || (!blackPiece && !whiteTurn)\n            || (blackPiece && whiteTurn))\n            return;\n        this.board.setWhereCanIGo(startPosition, blackPiece);\n    }\n    canMove(startPosition, nextPosition) {\n        const positionsWhereCanIGo = this.board.getPositionsWhereCanIGo(startPosition, !this.isWhiteTurn()).positions;\n        var nextPositionFound = false;\n        nextPositionFound = positionsWhereCanIGo.findIndex(position => position.x === nextPosition.x\n            && position.y === nextPosition.y) >= 0;\n        this.board.cleanBoardWhereCanIGo();\n        return nextPositionFound;\n    }\n    move(startPosition, nextPosition, backMove = false) {\n        let game = this;\n        if (startPosition.isSamePositionAs(nextPosition))\n            throw new Error('ERROR_CANT_MOVE_TO_SAME_POSITION');\n        if (!backMove)\n            if (!game.canMove(startPosition, nextPosition))\n                throw new Error('ERROR_CANT_MOVE_TO_POSITION');\n        game.board.move(startPosition, nextPosition, backMove, game.isWhiteTurn());\n        game.black.move(startPosition, nextPosition);\n        game.white.move(startPosition, nextPosition);\n        if (!backMove) {\n            game.movements.push({ startPosition, nextPosition });\n            game = getWinner(game);\n        }\n        return game;\n    }\n    backMove() {\n        this.board.cleanBoardWhereCanIGo();\n        let lastMove = this.movements.pop();\n        if (lastMove)\n            this.move(lastMove.nextPosition, lastMove.startPosition, true);\n        if (this.getPlayerTurn().isComputer()) {\n            lastMove = this.movements.pop();\n            if (lastMove) {\n                this.board.cleanBoardWhereCanIGo();\n                this.move(lastMove.nextPosition, lastMove.startPosition, true);\n            }\n        }\n    }\n    getColorTurn() {\n        return this.isWhiteTurn ? this.white : this.black;\n    }\n    getPlayerTurn() {\n        return this.isWhiteTurn ? this.players.white : this.players.black;\n    }\n    getNewCopy() {\n        return new Game(this);\n    }\n    getCopy() {\n        return copy(this);\n    }\n}\nexport function getCleanGameToSaveOnServer(game) {\n    const cleanGame = {\n        ended: game.ended,\n        movements: [],\n        blackWin: game.blackWin\n    };\n    cleanGame.movements = game.movements.map(move => {\n        const startPosition = new BoardPosition({ x: move.startPosition.x, y: move.startPosition.y });\n        const nextPosition = new BoardPosition({ x: move.nextPosition.x, y: move.nextPosition.y });\n        return { startPosition, nextPosition };\n    });\n    return cleanGame;\n}\nexport function getWinner(game) {\n    game.white = setColorWinners(game.white);\n    game.black = setColorWinners(game.black);\n    if (colorWin(game.white))\n        game.blackWin = false;\n    else if (colorWin(game.black))\n        game.blackWin = true;\n    return game;\n}\n//# sourceMappingURL=Game.js.map"]}